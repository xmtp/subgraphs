specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # PayerRegistry Contract
  - kind: ethereum
    name: PayerRegistry
    network: base-sepolia
    source:
      address: '0x3Ce54917177666d1a331fbb3F208a3B91218EC00'
      abi: PayerRegistry
      startBlock: 0 # @todo: Update to actual deployment block for faster sync
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - PayerRegistryTransaction
        - DailyPayerStats
        - PendingWithdrawal
      abis:
        - name: PayerRegistry
          file: ./abis/PayerRegistry.abi.json
      eventHandlers:
        - event: Deposit(indexed address,uint96)
          handler: handleDeposit
        - event: WithdrawalRequested(indexed address,uint96,uint32)
          handler: handleWithdrawalRequested
        - event: WithdrawalCancelled(indexed address)
          handler: handleWithdrawalCancelled
        - event: WithdrawalFinalized(indexed address)
          handler: handleWithdrawalFinalized
        - event: UsageSettled(indexed address,uint96)
          handler: handleUsageSettled
      file: ./src/payerRegistry.ts

  # RateRegistry Contract
  - kind: ethereum
    name: RateRegistry
    network: base-sepolia
    source:
      address: '0xdF3F8523FCdd590ec81d84b2eE0980E461D6d0f4'
      abi: RateRegistry
      startBlock: 0 # @todo: Update to actual deployment block for faster sync
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - RateUpdate
        - CurrentRate
      abis:
        - name: RateRegistry
          file: ./abis/RateRegistry.abi.json
      eventHandlers:
        - event: RatesUpdated(uint64,uint64,uint64,uint64)
          handler: handleRatesUpdated
      file: ./src/rateRegistry.ts

  # Erc20Inbox Contract - Bridge transaction tracking (Base -> XMTP)
  - kind: ethereum
    name: Erc20Inbox
    network: base-sepolia
    source:
      address: '0xd06d8E471F0EeB1bb516303EdE399d004Acb1615'
      abi: Erc20Inbox
      startBlock: 0 # @todo: Update to actual deployment block for faster sync
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - BridgeTransaction
      abis:
        - name: Erc20Inbox
          file: ./abis/Erc20Inbox.abi.json
      eventHandlers:
        - event: InboxMessageDelivered(indexed uint256,bytes)
          handler: handleInboxMessageDelivered
        - event: InboxMessageDeliveredFromOrigin(indexed uint256)
          handler: handleInboxMessageDeliveredFromOrigin
      file: ./src/erc20Inbox.ts
