specVersion: 0.0.5
schema:
  file: ./schema.graphql
dataSources:
  # PayerRegistry Contract - Balance and transaction tracking
  - kind: ethereum
    name: PayerRegistry
    network: base-sepolia
    source:
      address: '0x95E856F1542EB9Eb1BFB6019f0D438584b1652ed'
      abi: PayerRegistry
      startBlock: 0 # @todo: Update to actual deployment block for faster sync
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - PayerRegistryTransaction
        - PayerBalance
        - PendingWithdrawal
        - DailyStats
      abis:
        - name: PayerRegistry
          file: ./abis/PayerRegistry.abi.json
      eventHandlers:
        - event: Deposit(indexed address,uint96)
          handler: handleDeposit
        - event: WithdrawalRequested(indexed address,uint96,uint32)
          handler: handleWithdrawalRequested
        - event: WithdrawalCancelled(indexed address)
          handler: handleWithdrawalCancelled
        - event: WithdrawalFinalized(indexed address)
          handler: handleWithdrawalFinalized
        - event: UsageSettled(indexed address,uint96)
          handler: handleUsageSettled
      file: ./src/payerRegistry.ts

  # RateRegistry Contract - Rate tracking
  - kind: ethereum
    name: RateRegistry
    network: base-sepolia
    source:
      address: '0xe9Fb03945475587B03eA28b8118E2bc5B753E3E9'
      abi: RateRegistry
      startBlock: 0 # @todo: Update to actual deployment block for faster sync
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - RateUpdate
        - CurrentRate
      abis:
        - name: RateRegistry
          file: ./abis/RateRegistry.abi.json
      eventHandlers:
        - event: RatesUpdated(uint64,uint64,uint64,uint64)
          handler: handleRatesUpdated
      file: ./src/rateRegistry.ts

  # Erc20Inbox Contract - Bridge transaction tracking (Base -> XMTP)
  - kind: ethereum
    name: Erc20Inbox
    network: base-sepolia
    source:
      address: '0xd06d8E471F0EeB1bb516303EdE399d004Acb1615'
      abi: Erc20Inbox
      startBlock: 0 # @todo: Update to actual deployment block for faster sync
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - BridgeTransaction
        - CrossChainTransaction
      abis:
        - name: Erc20Inbox
          file: ./abis/Erc20Inbox.abi.json
      eventHandlers:
        - event: InboxMessageDelivered(indexed uint256,bytes)
          handler: handleInboxMessageDelivered
        - event: InboxMessageDeliveredFromOrigin(indexed uint256)
          handler: handleInboxMessageDeliveredFromOrigin
      file: ./src/bridgeInbox.ts

templates:
  # USDC Token Template - For tracking specific USDC transfers
  # @todo: Consider if template approach is needed or if direct data source is sufficient
  # @todo: Add instantiation logic in event handlers to create USDC tracking instances
  - kind: ethereum/contract
    name: ERC20Token
    network: base-sepolia
    source:
      abi: ERC20
    mapping:
      kind: ethereum/events
      apiVersion: 0.0.7
      language: wasm/assemblyscript
      entities:
        - USDCTransfer
        - USDCBalance
      abis:
        - name: ERC20
          file: ./abis/ERC20.abi.json
      eventHandlers:
        - event: Transfer(indexed address,indexed address,uint256)
          handler: handleTransfer
        - event: Approval(indexed address,indexed address,uint256)
          handler: handleApproval
      file: ./src/erc20.ts
