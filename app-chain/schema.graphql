# ============ Generic - Snapshot Interfaces ============ #

interface SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
}

interface IntSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    value: Int!
}

interface BigIntSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    value: BigInt!
}

interface TimestampSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    value: Timestamp!
}

interface StringSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    value: String!
}

interface BooleanSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    value: Boolean!
}

# ============ Account - Snapshot Interfaces ============ #

interface AccountSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
}

# ============ Account - Lifetime Total Snapshots ============ #

type GroupMessagesSentSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

type GroupMessageBytesSentSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

type GroupMessageTransactionFeesSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

type IdentityUpdatesCreatedSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

type IdentityUpdateBytesCreatedSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

type IdentityUpdateTransactionFeesSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

type TransactionFeesSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

type WithdrawnSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

type DepositsReceivedSnapshot implements AccountSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @index
    account: Account! @index
    value: BigInt!
}

# ============ Account - Event Entities ============ #

type GroupMessage @entity(immutable: true) {
    id: ID! @unique
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
    account: Account! @index
    groupId: String! @index
    sequenceId: BigInt! @index
    messageSize: Int!
    timestamp: Timestamp!
    transactionHash: String!
    logIndex: BigInt!
    transactionFee: BigInt!
}

type IdentityUpdate @entity(immutable: false) {
    id: ID! @unique
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
    account: Account! @index
    inboxId: String! @index
    sequenceId: BigInt! @index
    identityUpdateSize: Int!
    timestamp: Timestamp!
    transactionHash: String!
    logIndex: BigInt!
    transactionFee: BigInt!
}

# ============ Account - Entity ============ #

type Account @entity(immutable: false) {
    # Entity Properties
    id: ID! @unique
    lastUpdate: Timestamp!
    address: String! @unique

    # Lifetime Totals (and snapshots)
    groupMessagesSent: BigInt!
    groupMessagesSentSnapshots: [GroupMessagesSentSnapshot!] @derivedFrom(field: "account")
    groupMessageBytesSent: BigInt!
    groupMessageBytesSentSnapshots: [GroupMessageBytesSentSnapshot!] @derivedFrom(field: "account")
    groupMessageTransactionFees: BigInt!
    groupMessageTransactionFeesSnapshots: [GroupMessageTransactionFeesSnapshot!] @derivedFrom(field: "account")
    identityUpdatesCreated: BigInt!
    identityUpdatesCreatedSnapshots: [IdentityUpdatesCreatedSnapshot!] @derivedFrom(field: "account")
    identityUpdateBytesCreated: BigInt!
    identityUpdateBytesCreatedSnapshots: [IdentityUpdateBytesCreatedSnapshot!] @derivedFrom(field: "account")
    identityUpdateTransactionFees: BigInt!
    identityUpdateTransactionFeesSnapshots: [IdentityUpdateTransactionFeesSnapshot!] @derivedFrom(field: "account")
    transactionFees: BigInt!
    transactionFeesSnapshots: [TransactionFeesSnapshot!] @derivedFrom(field: "account")
    withdrawn: BigInt!
    withdrawnSnapshots: [WithdrawnSnapshot!] @derivedFrom(field: "account")
    depositsReceived: BigInt!
    depositsReceivedSnapshots: [DepositsReceivedSnapshot!] @derivedFrom(field: "account")

    # Event Entities
    groupMessages: [GroupMessage!] @derivedFrom(field: "account")
    identityUpdates: [IdentityUpdate!] @derivedFrom(field: "account")
    withdrawals: [Withdrawal!] @derivedFrom(field: "account")
    receivedDeposits: [Deposit!] @derivedFrom(field: "recipient")
}

# ============ GroupMessageBroadcaster - Snapshot Interfaces ============ #

interface GroupMessageBroadcasterSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
}

# ============ GroupMessageBroadcaster - State Variable Snapshots ============ #

type GroupMessageBroadcasterMinPayloadSizeSnapshot implements GroupMessageBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
    value: BigInt!
}

type GroupMessageBroadcasterMaxPayloadSizeSnapshot implements GroupMessageBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
    value: BigInt!
}

type GroupMessageBroadcasterPausedSnapshot implements GroupMessageBroadcasterSnapshotEntity & BooleanSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
    value: Boolean!
}

type GroupMessageBroadcasterPayloadBootstrapperSnapshot implements GroupMessageBroadcasterSnapshotEntity & StringSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
    value: String!
}

# ============ GroupMessageBroadcaster - Lifetime Total Snapshots ============ #

type GroupMessageBroadcasterTotalMessagesSentSnapshot implements GroupMessageBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
    value: BigInt!
}

type GroupMessageBroadcasterTotalMessageBytesSentSnapshot implements GroupMessageBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
    value: BigInt!
}

type GroupMessageBroadcasterTotalMessageTransactionFeesSnapshot implements GroupMessageBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    groupMessageBroadcaster: GroupMessageBroadcaster! @index
    value: BigInt!
}

# ============ GroupMessageBroadcaster - Entity ============ #

type GroupMessageBroadcaster @entity(immutable: false) {
    # Entity Properties
    id: ID! @unique
    lastUpdate: Timestamp!

    # State Variables (and snapshots)
    minPayloadSize: BigInt!
    minPayloadSizeSnapshots: [GroupMessageBroadcasterMinPayloadSizeSnapshot!]
        @derivedFrom(field: "groupMessageBroadcaster")
    maxPayloadSize: BigInt!
    maxPayloadSizeSnapshots: [GroupMessageBroadcasterMaxPayloadSizeSnapshot!]
        @derivedFrom(field: "groupMessageBroadcaster")
    paused: Boolean!
    pausedSnapshots: [GroupMessageBroadcasterPausedSnapshot!] @derivedFrom(field: "groupMessageBroadcaster")
    payloadBootstrapper: String!
    payloadBootstrapperSnapshots: [GroupMessageBroadcasterPayloadBootstrapperSnapshot!]
        @derivedFrom(field: "groupMessageBroadcaster")

    # Lifetime Totals (and snapshots)
    totalMessagesSent: BigInt!
    totalMessagesSentSnapshots: [GroupMessageBroadcasterTotalMessagesSentSnapshot!]
        @derivedFrom(field: "groupMessageBroadcaster")
    totalMessageBytesSent: BigInt!
    totalMessageBytesSentSnapshots: [GroupMessageBroadcasterTotalMessageBytesSentSnapshot!]
        @derivedFrom(field: "groupMessageBroadcaster")
    totalMessageTransactionFees: BigInt!
    totalMessageTransactionFeesSnapshots: [GroupMessageBroadcasterTotalMessageTransactionFeesSnapshot!]
        @derivedFrom(field: "groupMessageBroadcaster")

    # Event Entities
    groupMessages: [GroupMessage!] @derivedFrom(field: "groupMessageBroadcaster")
}

# ============ IdentityUpdateBroadcaster - Snapshot Interfaces ============ #

interface IdentityUpdateBroadcasterSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
}

# ============ IdentityUpdateBroadcaster - State Variable Snapshots ============ #

type IdentityUpdateBroadcasterMinPayloadSizeSnapshot implements IdentityUpdateBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
    value: BigInt!
}

type IdentityUpdateBroadcasterMaxPayloadSizeSnapshot implements IdentityUpdateBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
    value: BigInt!
}

type IdentityUpdateBroadcasterPausedSnapshot implements IdentityUpdateBroadcasterSnapshotEntity & BooleanSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
    value: Boolean!
}

type IdentityUpdateBroadcasterPayloadBootstrapperSnapshot implements IdentityUpdateBroadcasterSnapshotEntity & StringSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
    value: String!
}

# ============ IdentityUpdateBroadcaster - Lifetime Total Snapshots ============ #

type IdentityUpdateBroadcasterTotalIdentityUpdatesCreatedSnapshot implements IdentityUpdateBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
    value: BigInt!
}

type IdentityUpdateBroadcasterTotalIdentityUpdateBytesCreatedSnapshot implements IdentityUpdateBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
    value: BigInt!
}

type IdentityUpdateBroadcasterTotalIdentityUpdateTransactionFeesSnapshot implements IdentityUpdateBroadcasterSnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    identityUpdateBroadcaster: IdentityUpdateBroadcaster! @index
    value: BigInt!
}

# ============ IdentityUpdateBroadcaster - Entity ============ #

type IdentityUpdateBroadcaster @entity(immutable: false) {
    # Entity Properties
    id: ID! @unique
    lastUpdate: Timestamp!

    # State Variables (and snapshots)
    minPayloadSize: BigInt!
    minPayloadSizeSnapshots: [IdentityUpdateBroadcasterMinPayloadSizeSnapshot!]
        @derivedFrom(field: "identityUpdateBroadcaster")
    maxPayloadSize: BigInt!
    maxPayloadSizeSnapshots: [IdentityUpdateBroadcasterMaxPayloadSizeSnapshot!]
        @derivedFrom(field: "identityUpdateBroadcaster")
    paused: Boolean!
    pausedSnapshots: [IdentityUpdateBroadcasterPausedSnapshot!] @derivedFrom(field: "identityUpdateBroadcaster")
    payloadBootstrapper: String!
    payloadBootstrapperSnapshots: [IdentityUpdateBroadcasterPayloadBootstrapperSnapshot!]
        @derivedFrom(field: "identityUpdateBroadcaster")

    # Lifetime Totals (and snapshots)
    totalIdentityUpdatesCreated: BigInt!
    totalIdentityUpdatesCreatedSnapshots: [IdentityUpdateBroadcasterTotalIdentityUpdatesCreatedSnapshot!]
        @derivedFrom(field: "identityUpdateBroadcaster")
    totalIdentityUpdateBytesCreated: BigInt!
    totalIdentityUpdateBytesCreatedSnapshots: [IdentityUpdateBroadcasterTotalIdentityUpdateBytesCreatedSnapshot!]
        @derivedFrom(field: "identityUpdateBroadcaster")
    totalIdentityUpdateTransactionFees: BigInt!
    totalIdentityUpdateTransactionFeesSnapshots: [IdentityUpdateBroadcasterTotalIdentityUpdateTransactionFeesSnapshot!]
        @derivedFrom(field: "identityUpdateBroadcaster")

    # Event Entities
    identityUpdates: [IdentityUpdate!] @derivedFrom(field: "identityUpdateBroadcaster")
}

# ============ AppChainParameterRegistry Parameter - Snapshot Interfaces ============ #

interface ParameterSnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    parameter: Parameter! @index
}

# ============ AppChainParameterRegistry Parameter - State Variable Snapshots ============ #

type ParameterValueSnapshot implements ParameterSnapshotEntity & StringSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    parameter: Parameter! @index
    value: String!
}

# ============ AppChainParameterRegistry Parameter - Entity ============ #

type Parameter @entity(immutable: false) {
    id: ID! @unique
    lastUpdate: Timestamp!
    key: String! @unique
    value: String!
    valueSnapshot: ParameterValueSnapshot! @derivedFrom(field: "parameter")
    appChainParameterRegistry: AppChainParameterRegistry! @index
}

# ============ AppChainParameterRegistry - Entity ============ #

type AppChainParameterRegistry @entity(immutable: false) {
    # Entity Properties
    id: ID! @unique
    lastUpdate: Timestamp!

    # State Variable Mappings
    parameters: [Parameter!] @derivedFrom(field: "appChainParameterRegistry")
}

# ============ AppChainGateway - Snapshot Interfaces ============ #

interface AppChainGatewaySnapshotEntity implements SnapshotEntity {
    id: ID! @unique
    timestamp: Timestamp! @index
    appChainGateway: AppChainGateway! @index
}

# ============ AppChainGateway - State Variable Snapshots ============ #

type AppChainGatewayPausedSnapshot implements AppChainGatewaySnapshotEntity & BooleanSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    appChainGateway: AppChainGateway! @index
    value: Boolean!
}

# ============ AppChainGateway - Lifetime Total Snapshots ============ #

type AppChainGatewayTotalDepositsReceivedSnapshot implements AppChainGatewaySnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    appChainGateway: AppChainGateway! @index
    value: BigInt!
}

type AppChainGatewayTotalWithdrawnSnapshot implements AppChainGatewaySnapshotEntity & BigIntSnapshotEntity & SnapshotEntity
    @entity(immutable: false) {
    id: ID! @unique
    timestamp: Timestamp! @unique @index
    appChainGateway: AppChainGateway! @index
    value: BigInt!
}

# ============ AppChainGateway ReceivedParameter - Entity ============ #

type ReceivedParameter @entity(immutable: true) {
    id: ID! @unique
    key: String! @unique
    event: ParameterReceival!
}

# ============ AppChainParameterRegistry - Event Entities ============ #

type ParameterReceival @entity(immutable: true) {
    id: ID! @unique
    appChainGateway: AppChainGateway! @index
    parameters: [ReceivedParameter!] @derivedFrom(field: "event")
    timestamp: Timestamp!
    transactionHash: String!
    logIndex: BigInt!
}

type Withdrawal @entity(immutable: true) {
    id: ID! @unique
    appChainGateway: AppChainGateway! @index
    account: Account! @index
    recipient: String! @index
    amount: BigInt!
    messageId: BigInt! @index
    timestamp: Timestamp!
    transactionHash: String!
    logIndex: BigInt!
    transactionFee: BigInt!
}

type Deposit @entity(immutable: true) {
    id: ID! @unique
    appChainGateway: AppChainGateway! @index
    recipient: Account! @index
    amount: BigInt!
    timestamp: Timestamp!
    transactionHash: String!
    logIndex: BigInt!
    transactionFee: BigInt!
}

# ============ AppChainParameterRegistry - Entity ============ #

type AppChainGateway @entity(immutable: false) {
    # Entity Properties
    id: ID! @unique
    lastUpdate: Timestamp!

    # State Variable Mappings
    paused: Boolean!
    pausedSnapshots: [AppChainGatewayPausedSnapshot!] @derivedFrom(field: "appChainGateway")

    # Lifetime Totals (and snapshots)
    totalWithdrawn: BigInt!
    totalWithdrawnSnapshots: [AppChainGatewayTotalWithdrawnSnapshot!] @derivedFrom(field: "appChainGateway")
    totalDepositsReceived: BigInt!
    totalDepositsReceivedSnapshots: [AppChainGatewayTotalDepositsReceivedSnapshot!]
        @derivedFrom(field: "appChainGateway")

    # Event Entities
    parameterReceivals: [ParameterReceival!] @derivedFrom(field: "appChainGateway")
    withdrawals: [Withdrawal!] @derivedFrom(field: "appChainGateway")
    deposits: [Deposit!] @derivedFrom(field: "appChainGateway")
}
